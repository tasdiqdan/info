<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shifokorlar Bo‘limi - Quiz</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <link rel="stylesheet" href="style.css"> <!-- Dizayn fayli -->
</head>
<body>
    <div class="container">
        <h2>Shifokorlar bo‘limi</h2>
        <p>Mutaxassisligingizni tanlang</p>
        <div class="category-container">
            <button class="btn" onclick="selectCategory(this, 'Gemotologiya')">Gemotologiya</button>
            <button class="btn" onclick="selectCategory(this, 'Rentgenologiya')">Rentgenologiya</button>
            <button class="btn" onclick="selectCategory(this, 'Dezinfektologiya')">Dezinfektologiya</button>
            <button class="btn" onclick="selectCategory(this, 'Bolalar nevrologiyasi')">Bolalar nevrologiyasi</button>
            <button class="btn" onclick="selectCategory(this, 'Akusherlik va Ginekologiya')">Akusherlik va Ginekologiya</button>
            <button class="btn" onclick="selectCategory(this, 'Bolalar kardiologiyasi va revmatologiyasi')">Bolalar kardiologiyasi va revmatologiyasi</button>
        </div>
        <p>Savollar soni</p>
        <div class="question-count">
            <button class="btn" onclick="selectQuestionCount(this, 15)">15</button>
            <button class="btn" onclick="selectQuestionCount(this, 25)">25</button>
            <button class="btn" onclick="selectQuestionCount(this, 35)">35</button>
            <button class="btn" onclick="selectQuestionCount(this, 45)">45</button>
            <button class="btn" onclick="selectQuestionCount(this, 50)">50</button>
        </div>
        <button class="start-btn" onclick="startQuiz()">Testni boshlash</button>
    </div>
    
    <script>
        let selectedCategory = '';
        let selectedQuestionCount = 10;
        let questions = [];
        let currentQuestionIndex = 0;

        const pdfUrls = [
            "https://raw.githack.com/tasdiqdan/info/main/Gematologiya.pdf",
            "https://raw.githubusercontent.com/tasdiqdan/info/main/test2.pdf"
        ];

        function selectCategory(element, category) {
            document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('selected'));
            element.classList.add('selected');
            selectedCategory = category;
        }

        function selectQuestionCount(element, count) {
            document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('selected'));
            element.classList.add('selected');
            selectedQuestionCount = count;
        }

        async function loadPDF(url) {
            try {
                const loadingTask = pdfjsLib.getDocument(url);
                const pdf = await loadingTask.promise;
                let text = "";

                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    text += textContent.items.map(item => item.str).join(" ") + " ";
                }
                return text;
            } catch (error) {
                console.error("PDF yuklashda xatolik:", error);
                alert("PDF yuklashda xatolik! Iltimos, PDF fayl URL manzillari to‘g‘ri ekanini tekshiring.");
                return "";
            }
        }

        async function loadQuestionsFromGithub() {
            let allText = "";
            for (let url of pdfUrls) {
                let text = await loadPDF(url);
                allText += text + " ";
            }
            extractQuestions(allText);
            startQuizProcess();
        }

        function extractQuestions(text) {
            const regex = /\d+\. (.*?)\s*A: (.*?)\s*B: (.*?)\s*C: (.*?)\s*D: (.*?)(?=\s*\d+\.|$)/g;
            let allQuestions = [];
            let match;
            
            while ((match = regex.exec(text)) !== null) {
                let answers = [
                    { text: match[2].replace("*", "").trim(), correct: match[2].includes("*") },
                    { text: match[3].replace("*", "").trim(), correct: match[3].includes("*") },
                    { text: match[4].replace("*", "").trim(), correct: match[4].includes("*") },
                    { text: match[5].replace("*", "").trim(), correct: match[5].includes("*") }
                ];
                allQuestions.push({ question: match[1], answers: shuffleArray(answers) });
            }
            questions = shuffleArray(allQuestions).slice(0, selectedQuestionCount);
        }

        function startQuiz() {
            if (!selectedCategory) {
                alert('Iltimos, mutaxassislik tanlang!');
                return;
            }
            loadQuestionsFromGithub();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
